

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to build a neighbor list? &mdash; Rascal 0.0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/rascal.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Goals &amp; Design" href="../whitepaper.html" />
    <link rel="prev" title="&lt;no title&gt;" href="SOAP_CSD500.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Rascal
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#getting-started">Getting started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="tutorials.html#intro-for-developers">Intro for developers</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to build a neighbor list?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eigen-library"><cite>Eigen</cite> library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-neighborhood-manager">Creating a neighborhood manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commands-of-the-neighborhood-manager">Commands of the neighborhood manager:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../whitepaper.html">Goals &amp; Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SOAP.html">SOAP Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../representation/representations.html">Representations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../neighbor_list/neighbor-list-manager.html">Neighbor List Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/developer.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Rascal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>How to build a neighbor list?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/nl-for-user.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="how-to-build-a-neighbor-list">
<span id="nl-for-user"></span><h1>How to build a neighbor list?<a class="headerlink" href="#how-to-build-a-neighbor-list" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Here we provide a tutorial on how to use the C++ interface for building neighbor lists.</p>
<p>Rascal comes with a built-in neighborhood manager. The role of a neighborhood manager is to minimize manual handeling of building the neighborhood lists.
The current implementation avoids the explicit use of embedded lists to describe neighborhoods and makes iterations over them more trivial.
The neighborhood manager interface is universal to all the representations of Rascal. It can also be very easily interfaced with MD/MC simulation packages.
We prefer using <a class="reference external" href="http://eigen.tuxfamily.org/">Eigen</a> library for the linear algebra operations because of the versatility and flexibility allowed by the library.</p>
</div>
<div class="section" id="eigen-library">
<h2><cite>Eigen</cite> library<a class="headerlink" href="#eigen-library" title="Permalink to this headline">¶</a></h2>
<p><cite>Eigen</cite> is an open source library for linear algebra operatins in C++. It is implemented using expression templates techniques.
We usually use the following templates to describe the positions, the atomic numbers array,..etc</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Vector_t</span> <span class="o">=</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// dim = 1, 2 or 3</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">MATRIX</span><span class="p">(</span><span class="n">NROWS</span><span class="p">,</span><span class="n">NCOLUMNS</span><span class="p">);</span> <span class="c1">//</span>
<span class="k">using</span> <span class="n">rascal</span><span class="o">::</span><span class="n">VecXi</span> <span class="o">=</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Dynamic</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-neighborhood-manager">
<h2>Creating a neighborhood manager<a class="headerlink" href="#creating-a-neighborhood-manager" title="Permalink to this headline">¶</a></h2>
<p>First, the neighborhood manager is created and initialized using the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rascal::NeighborhoodManagerCell</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Manager_t</span> <span class="o">=</span> <span class="n">rascal</span><span class="o">::</span><span class="n">NeighbourhoodManagerCell</span><span class="p">;</span>
<span class="n">Manager_t</span> <span class="n">manager</span><span class="p">;</span> <span class="c1">// initialize the neighborhood manager</span>
</pre></div>
</div>
<p>While the neighborhood manager can be built for the first time using  <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rascal::NeighborhoodManagerCell::build</span></code>,
we recommend updating it using <code class="xref py py-class docutils literal notranslate"><span class="pre">rascal::NeighborhoodManagerCell::update</span></code>. The following inputs should be provided in order:</p>
<ul class="simple">
<li><p>the atomic positions matrix column wise as an <cite>Eigen</cite> matrix object</p></li>
<li><p>an array of the atomic numbers of the species</p></li>
<li><p>an array of centers ids</p></li>
<li><p>the cell vectors column wise as an <cite>Eigen</cite> matrix object</p></li>
<li><p>a boolean array of the periodic boundary conditions over the 3 axes</p></li>
<li><p>the maximum radial cutoff (in the units of the cell vectors and atomic positions)</p></li>
</ul>
<p>The folllowing code is an example of the inputs that need to be customized according to the user’s use, as in to provide
cell vectors, atomic positions and numbers and the ids of the centers.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">cell</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// the cell vectors matrix</span>

<span class="kt">int</span> <span class="n">number_of_atoms</span><span class="p">{</span><span class="mi">100</span><span class="p">};</span> <span class="c1">// the number of atoms in the structure</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">positions</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">number_of_atoms</span><span class="p">);</span> <span class="c1">// atomic postions matrix</span>
<span class="n">rascal</span><span class="o">::</span><span class="n">VecXi</span> <span class="n">numbers</span><span class="p">(</span><span class="mi">22</span><span class="p">);</span> <span class="c1">// atomic numbers array</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">center_ids</span><span class="p">{};</span> <span class="c1">// a vector containing the atomic centers ids</span>

<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">pbc</span><span class="p">{</span><span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">};</span> <span class="c1">// for periodic boundary conditions over the x axis only</span>

<span class="kt">double</span> <span class="n">cutoff</span><span class="p">{</span><span class="mf">3.5</span><span class="p">};</span> <span class="c1">// a radial cutoff distance of 3.5 angstrom</span>

<span class="n">manager</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">center_ids</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">pbc</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">);</span>
</pre></div>
</div>
<ul>
<li><div class="admonition note">
<p class="admonition-title">Note</p>
<p>A neighborhood manager can be updated as much as necessary by providing all the upmentioned inputs.</p>
</div>
</li>
</ul>
</div>
<div class="section" id="commands-of-the-neighborhood-manager">
<h2>Commands of the neighborhood manager:<a class="headerlink" href="#commands-of-the-neighborhood-manager" title="Permalink to this headline">¶</a></h2>
<p>In the current implementation of the neighborhood manager, the centers and their neighbors are <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rascal::Neighborhood</span> <span class="pre">Cell::ClusterRef</span></code> objects of order 1 and 2, respectively.
In order to access objects of order 2, we need to iterate over the corresponding order 1 object (the corresponding center).
This implementation has the advantage of not using explicit arrays to deal with center and neighbor properties.</p>
<p>Several methods are implemented for the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rascal::NeighborhoodCell::ClusterRef</span></code> objects (centers and their neighbors), such as retrieving
the index of the object, its position and its atom type.</p>
<ul>
<li><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The positions of order 2 are given with a certain offset relative to the position of the corresponding center of order 1. If one atom is included in the neighborhood of two different centers, it will have different positions depending on
the center being iterated over.</p>
</div>
</li>
<li><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The relative positions of the neighbors of a center are calculated on the fly and are not stored. If needed they have to be stored manually.</p>
</div>
</li>
</ul>
<dl class="simple">
<dt>This is an example of code than can be used to print to the screen the positions, types and indices of the centers and their neighbors. It also calculates the relative shift in the positions of every center’s neighbors</dt><dd><p>and its norm.</p>
</dd>
</dl>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">center</span> <span class="p">:</span> <span class="n">manager</span><span class="p">)</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">center_index</span><span class="p">{</span><span class="n">center</span><span class="p">.</span><span class="n">get_atom_index</span><span class="p">()};</span> <span class="c1">// get the index of the center atomic</span>
    <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">position</span><span class="p">{</span><span class="n">center</span><span class="p">.</span><span class="n">get_position</span><span class="p">()};</span> <span class="c1">// get the position vector of the center</span>
    <span class="k">auto</span> <span class="n">center_type</span><span class="p">{</span><span class="n">center</span><span class="p">.</span><span class="n">get_atom_type</span><span class="p">()};</span> <span class="c1">// get the atome type of the center</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Neighbors properties : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">neigh</span> <span class="p">:</span> <span class="n">center</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">neigh_index</span><span class="p">{</span><span class="n">center</span><span class="p">.</span><span class="n">get_atom_index</span><span class="p">()};</span> <span class="c1">// get the index of the neighbor</span>
        <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="n">position</span><span class="p">{</span><span class="n">neigh</span><span class="p">.</span><span class="n">get_position</span><span class="p">()};</span> <span class="c1">// get the position vector of the neighbor</span>
        <span class="k">auto</span> <span class="n">neigh_type</span><span class="p">{</span><span class="n">center</span><span class="p">.</span><span class="n">get_atom_type</span><span class="p">()};</span> <span class="c1">// get the atome type of the neighbor</span>
        <span class="k">auto</span> <span class="n">relative_shift</span><span class="p">{</span><span class="n">position</span> <span class="o">-</span> <span class="n">center</span><span class="p">.</span><span class="n">get_position</span><span class="p">()};</span> <span class="c1">// compute the position offset</span>

        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;This is the position of atom &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">neigh_index</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; of a type &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">neigh_type</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;The relative position is : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">neigh_position</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;The relative shift is : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">relative_shift</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;The norm of the shif is : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">relative_shift</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ang&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../whitepaper.html" class="btn btn-neutral float-right" title="Goals &amp; Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="SOAP_CSD500.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Chiheb Ben Mahmoud, Michele Ceriotti, Federico Giberti,
Klim Goldshtein, Till Junge, Markus Stricker, Félix Musil, Max Veit

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>